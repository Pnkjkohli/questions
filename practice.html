<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF Link Checker</title>
</head>
<body>
    <input type="file" id="uploadPDF" />
    <button onclick="processPDF()">Check Links</button>
    <ul id="linkResults"></ul>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
    <script>
        async function extractLinks(pdfData) {
            const pdf = await pdfjsLib.getDocument({ data: pdfData }).promise;
            let links = new Set();

            for (let pageNum = 1; pageNum <= pdf.numPages; pageNum++) {
                let page = await pdf.getPage(pageNum);
                let annotations = await page.getAnnotations();
                
                annotations.forEach((annot) => {
                    if (annot && annot.url) {
                        links.add(annot.url);
                    }
                });
            }
            return Array.from(links);
        }

        function isValidURL(url) {
            const regex = /^(https?:\/\/)?([\w-]+(\.[\w-]+)+)(:\d+)?(\/.*)?$/;
            return regex.test(url);
        }

        async function checkLinkStatus(url) {
            try {
                const response = await fetch(url, { method: "HEAD", mode: "no-cors" });
                return response.ok ? "Working" : "Not Working";
            } catch (error) {
                return "Not Working";
            }
        }

        async function processPDF() {
            const fileInput = document.getElementById("uploadPDF").files[0];
            if (!fileInput) {
                alert("Please upload a PDF file first.");
                return;
            }

            const reader = new FileReader();
            reader.onload = async function (event) {
                const pdfData = new Uint8Array(event.target.result);
                const links = await extractLinks(pdfData);
                const resultsList = document.getElementById("linkResults");
                resultsList.innerHTML = "";

                for (const link of links) {
                    const valid = isValidURL(link) ? "Valid URL" : "Invalid URL";
                    const working = await checkLinkStatus(link);
                    
                    let listItem = document.createElement("li");
                    listItem.innerHTML = `<a href="${link}" target="_blank">${link}</a> -> ${valid}, ${working}`;
                    resultsList.appendChild(listItem);
                }
            };
            reader.readAsArrayBuffer(fileInput);
        }
    </script>
</body>
</html>
